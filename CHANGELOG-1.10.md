# CHANGELOG для 1.10.x

## Новое
- **[Auth]** При вводе кода для входа добавлена проверка на IP-адрес.
- **[DataChangeLog]** Добавлены константы для часто используемых действий:
  - `insert` => `$data_change_log::ACTION_INSERT`
  - `update` => `$data_change_log::ACTION_UPDATE`
  - `delete` => `$data_change_log::ACTION_DELETE`
- **[File]** Проверка `container_type` перед добавлением файла.
- **[File - FileChecker]** Добавлены свойства `$checker` и `$log` для удобства.
- **[JS]** В хелпере `lemurro.tabs.tabInsertEdit` добавлены два опциональных аргумента:
  - `tabFormName` - имя таба с формой или null (тогда будет: tab-form)
  - `tabPrevName` - имя предыдущего таба или null (тогда будет: tab-list)
- **[JS-Helpers]** Добавлен хелпер `lemurro.tabs.getTabTitle`.
- **[LoggerFactory]** Добавлен необязательный параметр `channel_name`.
- **[ResponseException]** Добавлен класс `Lemurro\Api\Core\Exception\ResponseException`, ловится в ядре и превращается в `Response::exception($e)`.
- **[Roles]** Добавлена возможность указывать css-классы `js-role__PAGENAME--any`, показывает элемент при любом праве доступа в разделе.
- **[Sessions]** Удаление устаревших сессий вынесено в cron-задание (каждый час в 30 минут).
- **[SQL]** Настроены уникальные поля:
  - для таблицы `info_users` поле `user_id`
  - для таблицы `users` поле `auth_id`
- **[Tests]** Добавлены интеграционнные тесты.
- **[Tests]** Настройка GitHub Actions для автоматических тестов.
- **[Version]** Добавлено указание версий в api и web, когда они отлчичаются показывается сообщение о необходимости обновления окна браузера.
- **[Users]** Добавлено новое системное поле `email`.
- **[Users]** Пользователь с правом `Администратор` не может войти под другим пользователем с правом `Администратор`.
- **[Users]** Добавлена возможность искать пользователей с любым правом доступа в определённый раздел.

## Изменено
- **[Auth]** По умолчанию регистрация новых пользователей выключена.
- **[Core]** Вместо `Exception` при отлове ошибок теперь используется `Throwable`.
- **[Menu]** Исправлена ошибка в верхнем меню, когда пользователь с правом доступа в раздел `Справочники` не видел это меню.
- **[PHP]** Минимальная версия php 7.4.0+
- **[PHP-библиотеки]** Обновлены до актуальных версий следующие библиотеки:
  - `hellogerard/jobby` до версии `3.5+`
  - `monolog/monolog` до версии `2.3+`
  - `nesbot/carbon` до версии `2.54+`
  - `phpmailer/phpmailer` до версии `6.5+`
  - `pimple/pimple` до версии `3.5+`
  - `symfony/*` до версии `5.4+`
- **[Routes]** Из методов маршрутов убран OPTIONS за ненадобностью.
- **[Template7 Helper]** Хелпер `lemurrodecimal` выполняет перед выводом `value.toFixed(precision)`, чтобы все цифры были в едином стиле (вместо `123.5` теперь будет `123.50`, при `precision = 2`)
- **[Users]** На вкладке `Ключи доступа` изменена вёрстка и добавлено сообщение об отсутствии ключей

## Устарело
- **[Composer]** Убраны ненужные полифилы.
- **[File]** Удалена таблица `files_downloads`, переход на JWT-токены.
- **[Mobile]** Остановлена разработка пакетов `client-framework7` и `client-framework7-core-frontend`. В планах сделать мобильную версию без привязки к `Cordova` и возможностью подключить мобильную версию к `Cordova` или сделать `PWA`.
- **[Other]** Удалена ловушка для js-ошибок, генерировала очень высокую нагрузку в проектах с большим количеством пользователей и ошибками в консоли.
- **[Route]** Удалён GET-маршрут `/users`.